"""
인보이스 분석 프롬프트
"""

def get_invoice_prompt(text: str, file_name: str = "", page_number: int | None = None) -> str:
    """인보이스 분석 프롬프트 생성"""
    base_prompt = f"""
다음은 인보이스 문서입니다. 이는 개별 문서이므로 해당 문서에서만 정보를 추출해주세요.

문서 내용:
{text}

"""
    
    # 페이지 번호 정보 추가
    page_info = f"**현재 페이지 번호: {page_number}**" if page_number is not None else ""
    
    return base_prompt + f"""
이 인보이스에서 **다음 14개 필드만** 정확히 추출해주세요.

{page_info}

**중요: 여러 개의 인보이스가 있는 경우**
- Invoice No.가 다른 인보이스는 각각 개별 문서로 취급해주세요
- 배열 형태로 각 개별 인보이스의 정보를 모두 출력해주세요

**추출할 필드 (14개만):**
1. 업체명
    - 보통 페이지 최상단에 기재된 회사명 ((주), 주식회사, Co,. 등)
    - 거래처, Customer, 'To.' 가 아닌, 해당 Invoice를 발행한 회사명을 가져와야 합니다.
    - 보통 회사 로고 이미지와 함께 기재되어 있는 경우가 많습니다.
2. 일자
    - 일자, date 등 확인
    - 일자는 YYYY-MM-DD 형식으로 추출해주세요.
3. 송품장번호
    - Invoice No. 확인 (문서 식별자)
4. B/L번호
    - B.L No., B/L No. 등 확인
5. 출발지
    - P.O.L / ORIGIN 등으로 기재되어 있습니다.
6. 도착지
    - P.O.D / DESTINATION 등으로 기재되어 있습니다.
7. 총중량
    - WEIGHT 확인 (존재하는 경우)
8. 컨테이너번호
    - Container No. 등 확인 (존재하는 경우)
9. 페이지번호: {page_number if page_number is not None else "실제 파일의 페이지 번호 (예: 1, 2, 3...)"}
10. 품목정보: 테이블에서 품목명, 원화공급가, VAT 추출 (배열)
    - 품목의 경우, 테이블에서 'Sub Total, Total, 합계, 소계' 등으로 기재된 행을 제외하고 전부 추출해주세요.
    - 품목명 : 내역, Description, 품목, 품목명 등으로 식별됨.
    - 원화공급가 : 공급가액, 공급가, 공급가액(KRW), KRW 등으로 식별됨.
    - 부가세 : 부가세액, 부가세, 부가세액(KRW), VAT 등으로 식별됨.
11. 공급가액Total: 원화공급가를 식별한 열의 Total(합계) 금액 확인 (Sub total, total이 전부 존재하는 경우에는 Sub total이 아닌 total을 읽어와야 합니다.)
12. 부가세액Total: 부가세를 식별한 열의 Total(합계) 금액 확인 (Sub total, total이 전부 존재하는 경우에는 Sub total이 아닌 total을 읽어와야 합니다.)
13. 파일명: "{file_name}"
14. 페이지번호: {page_number if page_number is not None else "실제 파일의 페이지 번호 (예: 1, 2, 3...)"}

**중요한 지침:**
1. **위 14개 필드만 추출하고, 다른 정보는 절대 포함하지 마세요**
2. Invoice No.가 다른 인보이스는 각각 개별 문서로 처리
3. 모든 금액은 KRW(원화) 기준으로 추출
4. 존재하지 않는 정보는 "정보 없음"으로 표시
5. **요청하지 않은 필드는 절대 추가하지 마세요**
6. **문서에 있는 다른 모든 정보는 무시하고 위 14개 필드만 추출하세요**
7. **추가 설명이나 주석 없이 순수한 JSON 배열만 반환하세요**
8. **각 필드명은 정확히 위에 명시된 대로 사용하세요**

JSON 형태로 정리해주세요. 예시:
[
  {{
    "업체명": "ABC무역(주)",
    "일자": "2024-01-15",
    "송품장번호": "INV-2024-001",
    "B/L번호": "BL123456789",
    "출발지": "부산항",
    "도착지": "로스앤젤레스",
    "총중량": "1,500 kg",
    "컨테이너번호": "ABCD1234567",
    "페이지번호": 1,
    "품목정보": [
      {{
        "품목명": "전자제품",
        "원화공급가": 1,000,000,
        "부가세": 100,000
      }},
      {{
        "품목명": "의류",
        "원화공급가": 500,000,
        "부가세": 50,000
      }}
    ],
    "공급가액Total": 1,500,000,
    "부가세액Total": 150,000,
    "파일명": "{file_name}",
    "페이지번호": {page_number if page_number is not None else 1}
  }}
]
```""" 