def get_export_declaration_prompt(text: str, file_name: str = "", page_number: int = None) -> str:
    """수출신고필증 분석 프롬프트 생성 (개선된 버전)"""
    base_prompt = f"""
다음은 수출신고필증 문서입니다. 이는 개별 문서이므로 해당 문서에서만 정보를 추출해주세요.

**제일 중요한 내용 - 페이지 통합 지침:**
1. 수출신고필증 문서 오른쪽 하단에 "Page: 1/4", "Page: 2/4" 형태로 페이지 번호가 표시됩니다.
2. 이 페이지 번호는 **하나의 수출신고필증이 몇 페이지로 구성되어 있는지**를 나타냅니다.
3. **같은 신고번호를 가진 페이지들을 모두 찾아서 하나의 완전한 수출신고필증으로 통합**해주세요.
4. 예를 들어 "Page: 1/4", "Page: 2/4", "Page: 3/4", "Page: 4/4"가 모두 같은 신고번호라면, 이 4페이지를 하나의 수출신고필증으로 처리합니다.

문서 내용: {text}
"""
    
    # 페이지 번호 정보 추가
    page_info = f"**현재 페이지 번호: {page_number}**" if page_number is not None else ""
    
    return base_prompt + f"""
이 수출신고필증(갑지)에서 **다음 12개 필드만** 정확히 추출해주세요.
{page_info}

**페이지 통합 처리 방법:**
1. **신고번호 확인**: 각 페이지의 5번 항목 신고번호를 확인하세요. 신고번호가 **가장 중요한 정보**이므로 숫자가 희미하더라도 세심하게 확인하고, 0과 1 구별에 신경써주세요.
2. **페이지 범위 확인**: 오른쪽 하단의 "Page: X/Y" 형태를 확인하여 전체 페이지 수를 파악하세요
3. **통합 처리**: 같은 신고번호를 가진 모든 페이지의 정보를 종합하여 하나의 완전한 수출신고필증을 구성하세요
4. **정보 누락 방지**: 여러 페이지에 걸쳐 있는 정보가 누락되지 않도록 모든 페이지를 참고하세요

**여러 개의 수출신고필증이 있는 경우:**
- 신고번호가 동일한 수출신고필증이 여러페이지에 있는 경우 모든 페이지를 통합하여 하나의 완전한 수출신고필증을 구성하세요
- 신고번호가 다른 수출신고필증은 각각 개별 문서로 취급해주세요
- 각 수출신고필증마다 페이지 번호를 반드시 포함해주세요
- 배열 형태로 각 개별 수출신고필증의 정보를 모두 출력해주세요

**란 번호가 여러개 있는 경우:**
- 신고번호가 동일한 수출신고필증 내 란 번호가 여러개인 경우 각각의 세번부호, 순중량을 모두 출력해주세요.
- 각 수출신고필증마다 페이지 번호를 반드시 포함해주세요
- 배열 형태로 각 란번호의 정보를 모두 출력해주세요

**추출할 필드 (12개만):**

1. **신고번호**:
   - 위치: 5번 항목 신고번호
   - 형태: 숫자+영문자 조합 (예: 20246-11-68383G)
   - 주의: 신고번호는 페이지 통합 기준이 되는 절대적으로 중요한 필드입니다.
         Vision 인식 오류가 자주 발생하므로, 다음을 반드시 지켜주세요:
         - "0"과 "O", "1"과 "I", "6"과 "G", "5"와 "S"를 절대 혼동하지 마세요
         - 문서에 보이는 문자 그대로를 정확히 복사하세요 (추측하거나 보정하지 마세요)
         - 신고번호는 보통 문서 상단, 5번 항목에 위치하며, "신고번호:" 라벨과 함께 나옵니다.
         - **정확하지 않으면 페이지 통합이 잘못되어 전체 분석이 무의미해집니다**

2. **송품장번호**:
   - 위치: 39번 항목 송품장부호
   - 형태: 영문자+숫자 조합 또는 "-" 표시
   - 빈 칸이거나 없으면 "정보 없음"
    - 주의: Vision 인식 오류가 자주 발생하므로, 다음을 반드시 지켜주세요:
         - "0"과 "O", "1"과 "I", "6"과 "G", "5"와 "S"를 절대 혼동하지 마세요
         - 문서에 보이는 문자 그대로를 정확히 복사하세요 (추측하거나 보정하지 마세요)
         - 송품장번호는 보통 문서 중앙 하단, 세번부호 바로 아래에 위치합니다.
         - **정확하지 않으면 페이지 통합이 잘못되어 전체 분석이 무의미해집니다**  

3. **일자**:
   - 위치: 7번 항목 신고일자
   - 형태: YYYY.MM.DD 또는 YYYY/MM/DD
   - 출력: YYYY-MM-DD 형식으로 통일
   - 날짜가 없거나 읽을 수 없는 경우 "정보 없음"

4. **파일명**: "{file_name}"

5. **페이지번호**:
   - 값: {page_number if page_number is not None else "실제 파일의 페이지 번호"}
   - 수출신고필증 하나가 여러 페이지일 경우 첫 페이지의 실제 파일 상 페이지 번호 반환
   - 예: 파일에서 5~8페이지가 하나의 수출신고필증일 경우 페이지 번호는 5로 반환

6. **총중량**:
   - 위치: 44번 항목 총중량(페이지의 왼쪽에 위치하며 운임 항목 바로 위에 위치함.)
   - 형태: 숫자 + "(KG)" 단위
   - 쉼표(,), 점(.)으로 구분된 숫자 포함, 단위 포함하여 추출
   - 단위가 없는 경우 "KG"를 추가하여 출력

7. **순중량**:
   - 위치: 품명/규격 테이블 내 순중량 컬럼 (우측 하단 테이블 영역)
   - 형태: 숫자 + "(KG)" 단위 또는 단위 없이 숫자만
   - 테이블 형태로 되어 있으며, 여러 줄에 걸쳐 있을 수 있음
   - 쉼표(,), 점(.)으로 구분된 숫자 포함
   - 단위가 없는 경우 "KG"를 추가하여 출력

8. **컨테이너번호**:
   - 위치: 컨테이너번호
   - 형태: 영문자+숫자 조합 (예: ABCD1234567)
   - 빈 칸이거나 없으면 "정보 없음"

9. **출발지**:
   - 위치: 14번 적재항 항목 (문서 상단 부분 오른쪽, 거래구분 항목 아래쪽에 위치, 목적국 오른쪽에 위치)
   - 형태: 영문 항구코드 또는 항구명
   - 실제 문서에서는 "적재항" 라벨 다음에 영문 이니셜이 표기됨 (예: KRPUS, VNPTG, TWKHH)
   - 기재된 영문 이니셜 아래 항구명을 정확하게 인식해 가져와주세요. (예: 부산항)
   - 작은 글씨로 되어 있을 수 있음
   - 항구코드가 없는 경우 "정보 없음"

10. **도착지**:
    - 위치: 13번 목적국 항목 (문서 상단 부분 오른쪽, 거래구분 항목 바로 아래에 위치)
    - 형태: 영문 국가명 (예: VIETNAM, CAMBODIA, TAIWAN)
    - 실제 문서에서는 "목적국" 라벨 다음에 영문 국가명으로 표기됨
    - 국가명을 정확히 인식 (예: VIETNAM으로 표기된 경우 그대로 추출)
    - 국가명이 없는 경우 "정보 없음"

11. **세번부호**:
    - 위치: 세번부호 (문서 중앙 하단 품명/규격 테이블 영역 내)
    - 형태: 숫자.숫자-숫자 (예: 2202.99-9000)
    - 테이블 형태로 되어 있으며, 품명과 함께 표기됨
    - 점(.)과 하이픈(-)을 정확히 구분
    - 실제 문서에서는 품명 테이블 왼쪽에 세번부호가 표기되어 있음
    - 세번부호가 없는 경우 "정보 없음"

12. **란번호**:
    - 위치: 품명/규격 테이블의 맨 왼쪽 컬럼 (일련번호 역할)
    - 형태: 숫자 (예: 001, 002, 1, 2)
    - 테이블의 각 행마다 부여되는 일련번호
    - 실제 문서에서는 테이블 첫 번째 컬럼에 숫자로 표기됨
    - 선행 0이 있을 수도 있고 없을 수도 있음 (001 또는 1)
    - 란번호가 없는 경우 "정보 없음"

**데이터 검증 및 품질 관리:**
1. **신고번호 검증**: 신고번호는 필수 정보이므로 반드시 추출해야 함
2. **날짜 형식 통일**: 모든 날짜는 YYYY-MM-DD 형식으로 출력
3. **중량 단위 통일**: 모든 중량은 KG 단위로 출력
4. **코드 정확성**: 항구코드, 국가명, 세번부호는 정확한 형식으로 출력
5. **null 값 처리**: 빈 값은 "정보 없음"으로 통일

**특별 주의사항:**
1. **문서 구조 파악**: 실제 수출신고필증은 상단에 기본 정보, 중간에 거래 정보, 하단에 품명/규격 테이블 구조로 되어 있음
2. **테이블 영역 집중**: 순중량, 세번부호, 란번호는 모두 하단 테이블 영역에 있으므로 이 부분을 집중적으로 분석
3. **작은 글씨 주의**: 송품장번호, 출발지, 도착지는 상대적으로 작은 글씨로 표기되어 있을 수 있음
4. **라벨 확인**: 각 정보 앞에 "송품장부호", "적재항", "목적국" 등의 라벨이 있으므로 이를 참고하여 정확한 위치 파악
5. **테이블 구조**: 품명/규격 테이블은 여러 컬럼으로 구성되어 있으므로 각 컬럼을 정확히 구분하여 읽기
6. 문자가 흐릴 수 있으나 꼼꼼하게 읽고, 정보를 최대한 추출하세요.
2. **위 12개 필드만 추출하고, 다른 정보는 절대 포함하지 마세요**
3. **페이지 통합이 우선**: 같은 신고번호의 모든 페이지를 먼저 통합한 후 정보를 추출하세요
4. **완전성 보장**: 여러 페이지에 걸쳐 있는 정보가 누락되지 않도록 모든 관련 페이지를 확인하세요
5. 각 문서마다 페이지 번호를 반드시 포함 (실제 파일의 페이지 번호)
6. 존재하지 않는 정보는 "정보 없음"으로 표시하나, 정보가 정말 없는 것인지 두번 확인하세요.
7. **요청하지 않은 필드는 절대 추가하지 마세요**
8. **문서에 있는 다른 모든 정보는 무시하고 위 12개 필드만 추출하세요**
9. **추가 설명이나 주석 없이 순수한 JSON 배열만 반환하세요**
10. **각 필드명은 정확히 위에 명시된 대로 사용하세요**
11. **페이지 통합 시 신고번호가 동일한지 반드시 확인하세요**

**출력 형식:**
- 순수한 JSON 배열만 반환
- 각 수출신고필증당 하나의 JSON 객체
- 필드명은 정확히 명시된 대로 사용
- 문자열 값은 쌍따옴표로 감싸기
- 숫자 값(페이지번호)은 쌍따옴표 없이 출력

JSON 형태로 정리해주세요. 예시:
[
  {{
    "신고번호": "12760-11-102542X",
    "송품장번호": "24HTP19",
    "일자": "2024-01-01",
    "총중량": "1,000.23(KG)",
    "컨테이너번호": "CONT1234567",
    "출발지": "KRINC",
    "도착지": "CAMBODIA",
    "파일명": "{file_name}",
    "페이지번호": {page_number if page_number is not None else 1},
   "세부정보": [
      {{
        "란번호": "001",
        "세번부호": "2206.00-2030",
        "순중량": "900.23(KG)",
      }},
      {{
        "란번호": "002",
        "세번부호": "2203.00-2030",
        "순중량": "50.23(KG)",
      }}
    ],

  }}
]
"""